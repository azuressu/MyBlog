![header](https://capsule-render.vercel.app/api?type=waving&color=auto&height=200&section=header&text=ë¸”ë¡œê·¸%20ë°±ì—”ë“œ%20ì„œë²„%20lv2&fontSize=50)
## ğŸ“ ë¸”ë¡œê·¸ ë°±ì—”ë“œ ì„œë²„ ë§Œë“¤ê¸° Lv2
âœï¸ ê°œì¸ê³¼ì œ âœï¸

## ğŸ“ í”„ë¡œê·¸ë¨ ìš”êµ¬ì‚¬í•­
1. íšŒì› ê°€ì… API
  - username, passwordë¥¼ Clientì—ì„œ ì „ë‹¬ë°›ê¸°
  - usernameì€ ìµœì†Œ 4ì ì´ìƒ 10ì ì´í•˜ì´ë©° ì•ŒíŒŒë²³ ì†Œë¬¸ìì™€ ìˆ«ìë¡œ êµ¬ì„±
  - passwordëŠ” ìµœì†Œ 8ì ì´ìƒ 15ì ì´í•˜ì´ë©° ì•ŒíŒŒë²³ ëŒ€ì†Œë¬¸ìì™€ ìˆ«ìë¡œ êµ¬ì„±
  - DBì— ì¤‘ë³µëœ usernameì´ ì—†ë‹¤ë©´ íšŒì›ì„ ì €ì¥í•˜ê³  Clientë¡œ ì„±ê³µí–ˆë‹¤ëŠ” ë©”ì‹œì§€ì™€ ìƒíƒœì½”ë“œ ë°˜í™˜
2. ë¡œê·¸ì¸ API
  - username, passwordë¥¼ Clientì—ì„œ ì „ë‹¬ë°›ê¸°
  - DBì—ì„œ usernameì„ ì‚¬ìš©í•´ ì €ì¥ëœ íšŒì›ì˜ ìœ ë¬´ë¥¼ í™•ì¸í•˜ê³ , ìˆë‹¤ë©´ password ë¹„êµ
  - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ë¡œê·¸ì¸ì— ì„±ê³µí•œ ìœ ì €ì˜ ì •ë³´ì™€ JWTë¥¼ í™œìš©í•´ í† í°ì„ ë°œê¸‰í•˜ê³ , ë°œê¸‰í•œ í† í°ì„ Headerì— ì¶”ê°€í•œ í›„ ì„±ê³µí–ˆë‹¤ëŠ” ë©”ì‹œì§€ì™€ ìƒíƒœì½”ë“œ Clientì— ë°˜í™˜
3. ì „ì²´ ê²Œì‹œê¸€ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” API
  - ì œëª©, ì‘ì„±ìëª…(username), ì‘ì„± ë‚´ìš©, ì‘ì„± ë‚ ì§œ ì¡°íšŒ
  - ì‘ì„± ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
4. ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ëŠ” API
  - í† í°ì„ ê²€ì‚¬í•´ ìœ íš¨í•œ í† í°ì¼ ê²½ìš°ì—ë§Œ ì‘ì„± ê°€ëŠ¥
  - ì œëª©, ì‘ì„± ë‚´ìš© ì €ì¥
  - ì €ì¥ëœ ê²Œì‹œê¸€ì„ Clientë¡œ ë°˜í™˜ (usernameì€ ë¡œê·¸ì¸ ëœ ì‚¬ìš©ì)
5. ì„ íƒí•œ ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ëŠ” API
  - ì„ íƒí•œ ê²Œì‹œê¸€ì˜ ì œëª©, ì‘ì„±ìëª…, ì‘ì„± ë‚ ì§œ, ì‘ì„± ë‚´ìš© ì¡°íšŒ
  - ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì•„ë‹Œ, ê°„ë‹¨í•œ ê²Œì‹œê¸€ ì¡°íšŒë¡œ êµ¬í˜„
6. ì„ íƒí•œ ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ëŠ” API
  - í† í°ì„ ê²€ì‚¬í•´ ìœ íš¨í•œ í† í°ì´ë©´ì„œ í•´ë‹¹ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ë§Œ ìˆ˜ì • ê°€ëŠ¥
  - ì œëª©, ì‘ì„± ë‚´ìš©ì„ ìˆ˜ì •í•˜ê³  ìˆ˜ì •ëœ ê²Œì‹œê¸€ì„ Clientë¡œ ë°˜í™˜
7. ì„ íƒí•œ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ëŠ” API
  - í† í°ì„ ê²€ì‚¬í•´ ìœ íš¨í•œ í† í°ì´ë©´ì„œ í•´ë‹¹ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ë§Œ ì‚­ì œ ê°€ëŠ¥
  - ì„ íƒí•œ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ê³  Clientë¡œ ì„±ê³µí–ˆë‹¤ëŠ” ë©”ì‹œì§€ì™€ ìƒíƒœì½”ë“œ ë°˜í™˜

## ì‚¬ìš©í•œ Tool
<img src="https://img.shields.io/badge/git-F05032?style=flat&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=flat&logo=github&logoColor=white">
<img src ="https://img.shields.io/badge/Java-007396?&style=flat&logo=Java&logoColor=white">
<img src="https://img.shields.io/badge/intellijidea-000000?style=flat&logo=intellijidea&logoColor=white">

## ğŸª¶ API ëª…ì„¸ì„œ
<img src="https://github.com/azuressu/MyBlog/assets/74248726/aded181c-a03e-422f-a343-06cbbf17a9cd"  width="800"/>
<img src="https://github.com/azuressu/MyBlog/assets/74248726/9596f8bc-18ef-4896-a795-358417855d34"  width="800"/>
<img src="https://github.com/azuressu/MyBlog/assets/74248726/7138c328-f7c8-476b-9dc1-d0e3e8d71024"  width="800"/>

## ğŸ“œ í…Œì´ë¸” êµ¬ì„±
<img src="https://github.com/azuressu/MyBlog/assets/74248726/e1d3f00b-6bd3-4394-a9d3-d204d0db172a"  width="800"/>
<img src="https://github.com/azuressu/MyBlog/assets/74248726/8f3c37d7-e954-45db-8803-89278d03d78a"  width="800"/>

## ğŸ“ƒ ERD ì„¤ê³„
<img src="https://github.com/azuressu/MyBlog/assets/74248726/06683415-edf4-4a32-84de-99d42be2164f"  width="800"/>
<img src="https://github.com/azuressu/MyBlog/assets/74248726/75d1f15d-37cb-4673-bc6c-a352687c9b72"  width="800"/>

## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì„±
1. controller íŒ¨í‚¤ì§€ â€“ PostController.java, UserController.java

2. dto íŒ¨í‚¤ì§€ â€“ PostRequestDto.java, PostResponseDto.java, SignupRequestDto.java, StatusResponseDto.java, LoginRequestDto.java 

3. entity íŒ¨í‚¤ì§€ â€“ Post.java, Timestapmed.java, User.java, UserRoleEnum.java

4. repository íŒ¨í‚¤ì§€ â€“ PostRepository,java, UserRepository.java

5. service íŒ¨í‚¤ì§€ â€“ PostService.java, UserService.java

6. jwt íŒ¨í‚¤ì§€ â€“ JwtUtil.java

7. security íŒ¨í‚¤ì§€ â€“ JwtAuthenticationFilter.java, JwtAuthorizationFilter.java, UserDetailsImpl.java, UserDetailsServiceImpl.java, WebSecurityConfig.java

## ğŸª„ ì½”ë“œ êµ¬ì„±

1. controller íŒ¨í‚¤ì§€

1-1. PostController.java
```java
@RestController // ResponseBodyëŠ” ë¶™ì´ë©´ ì•ˆë¨ !
@RequestMapping("/api")
public class PostController {

    private final PostService postService;
    public PostController(PostService postService) { this.postService = postService; }

    // ê²Œì‹œê¸€ ì‘ì„±
    @PostMapping("/post")
    public PostResponseDto createPost(@RequestBody PostRequestDto requestDto, @AuthenticationPrincipal UserDetailsImpl userDetails) {
        return postService.createPost(requestDto, userDetails);
    }

    // ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ
    @GetMapping("/posts")
    public List<PostResponseDto> getPosts() {
        return postService.getPosts();
    }

    // ì„ íƒ ê²Œì‹œê¸€ ì¡°íšŒ
    @GetMapping("/post/{id}")
    public PostResponseDto getOnePost(@PathVariable Long id) {
        return postService.getOnePost(id);
    }

    // ì„ íƒ ê²Œì‹œê¸€ ìˆ˜ì •
    @PutMapping("/post/{id}")
    public PostResponseDto updatePost(@PathVariable Long id, @RequestBody PostRequestDto requestDto, @AuthenticationPrincipal UserDetailsImpl userDetails) {
        return postService.updatePost(id, requestDto, userDetails);
    }

    // ì„ íƒ ê²Œì‹œê¸€ ì‚­ì œ
    @DeleteMapping("/post/{id}")
    public StatusResponseDto deletePost(@PathVariable Long id, @AuthenticationPrincipal UserDetailsImpl userDetails){
        return postService.deletePost(id, userDetails);
    }

}
```
ê²Œì‹œê¸€ì— ëŒ€í•œ Controller ì—­í• ì„ í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.
ê¸°ëŠ¥ë³„ë¡œ urlê³¼ ë©”ì†Œë“œë¥¼ ê°ê° ë§¤í•‘í•˜ì—¬ ì‘ì„±í–ˆë‹¤.
í† í°ìœ¼ë¡œë¶€í„° ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ì•¼ í•˜ë¯€ë¡œ ê²Œì‹œê¸€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œì—ëŠ” @AuthenticationPrincipal ì—ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í–ˆë‹¤.

1-2. UserController.java
```java
@RestController
@RequestMapping("/api")
public class UserController {

    private final UserService userService;
    public UserController(UserService userService) { this.userService = userService; }

    // íšŒì›ê°€ì…
    @PostMapping("/user/signup")
    public StatusResponseDto signup(@RequestBody SignupRequestDto signupRequestDto) {
        return userService.signup(signupRequestDto);
    }
}
```
ì‚¬ìš©ìì— ëŒ€í•œ Controller ì—­í• ì„ í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.
íšŒì›ê°€ì…ì„ ì§„í–‰í•  urlì™€ ë©”ì†Œë“œë¥¼ ì‘ì„±í–ˆë‹¤.


2. dto íŒ¨í‚¤ì§€
   
2-1. LoginRequestDto.java
```java
@Getter
@Setter
public class LoginRequestDto {
    @NotBlank
    private String username;  // ì‚¬ìš©ì ì´ë¦„
    @NotBlank
    private String password;   // ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸
}
```
ë¡œê·¸ì¸ì„ í•  ë•Œ, ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ê¸° ìœ„í•œ requestDto í´ë˜ìŠ¤ì´ë‹¤.

2-2. PostRequestDto.java 
```java
@Getter
public class PostRequestDto {
    private String title;      // ê²Œì‹œê¸€ ì œëª©
    private String contents; // ê²Œì‹œê¸€ ë‚´ìš©
}
```
ê²Œì‹œê¸€ì„ ì‘ì„±í•  ë•Œ, ê²Œì‹œê¸€ì˜ ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥ë°›ê¸° ìœ„í•œ requestDto í´ë˜ìŠ¤ì´ë‹¤.

2-3. PostResponseDto.java
```java
@Getter
public class PostResponseDto {

    private Long id;                    // ê²Œì‹œê¸€ ë²ˆí˜¸
    private String username;           // ì‚¬ìš©ì ì´ë¦„
    private String contents;            // ê²Œì‹œê¸€ ë‚´ìš©
    private String title;                 // ê²Œì‹œê¸€ ì œëª©
    private LocalDateTime createTime;  // ê²Œì‹œê¸€ ì‘ì„±ì¼
    private LocalDateTime modifyTime; // ê²Œì‹œê¸€ ìˆ˜ì •ì¼

    public PostResponseDto(Post post) {
        this.id = post.getId();
        this.title = post.getTitle();
        this.username = post.getUser().getUsername();
        this.contents = post.getContents();
        this.createTime = post.getCreateTime();
        this.modifyTime = post.getModifyTime();
    }
}
```
ê²Œì‹œê¸€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ë‚´ì£¼ê¸° ìœ„í•œ responseDto í´ë˜ìŠ¤ì´ë‹¤.
ê²Œì‹œê¸€ ë²ˆí˜¸, ì‚¬ìš©ì ì´ë¦„, ê²Œì‹œê¸€ì˜ ì œëª©ê³¼ ë‚´ìš©, ê²Œì‹œê¸€ì˜ ì‘ì„±ì¼ê³¼ ìˆ˜ì •ì¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤.

2-4. SignupRequestDto.java
```java
@Getter
@Setter
public class SignupRequestDto {
    @NotBlank
    @Size(min = 4, max = 10)
    @Pattern(regexp = "^[a-z0-9]{4,10}$", message = "ì•ŒíŒŒë²³ ì†Œë¬¸ìì™€ ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤")
    private String username;  // ì‚¬ìš©ì ì´ë¦„

    @NotBlank
    @Size(min = 8, max = 15, message = "8ìì—ì„œ 15ìë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤")
    @Pattern(regexp = "^[A-Za-z0-9@$!%*?&]*$", message = "ì•ŒíŒŒë²³ ëŒ€ì†Œë¬¸ìì™€ ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤")
    private String password;   // ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸
}
```
íšŒì›ê°€ì…ì„ í•  ë•Œ ì‚¬ìš©ìì˜ ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ë°›ê¸° ìœ„í•œ requestDto í´ë˜ìŠ¤ì´ë‹¤.
ì‚¬ìš©ìì˜ ì´ë¦„ì€ ìµœì†Œ 4ìì—ì„œ 10ì, ì•ŒíŒŒë²³ ì†Œë¬¸ìì™€ ìˆ«ìë§Œ ì…ë ¥ë°›ì„ ìˆ˜ ìˆë‹¤.
ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ìì—ì„œ 15ìì´ë©°, ì•ŒíŒŒë²³ ëŒ€ì†Œë¬¸ìì™€ ìˆ«ìë§Œ ì…ë ¥ë°›ì„ ìˆ˜ ìˆë‹¤.

2-5. StatusResponseDto.java
```java
@Getter
@Setter
public class StatusResponseDto {
    String msg;
    Integer statusCode;
}
```

ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ì™€ ìƒíƒœì½”ë“œë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•œ responseDto í´ë˜ìŠ¤ì´ë‹¤.


3. entity íŒ¨í‚¤ì§€
   
3-1. Post.java
```java
@Entity
@Getter
@Setter
@Table(name = "post")
@NoArgsConstructor
public class Post extends Timestamped{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)   // auto_increase
    private Long id;
    @Column(name = "title", nullable = false)
    private String title;
    @Column(name = "contents", nullable = false)
    private String contents;

    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;

    public Post(PostRequestDto requestDto) {
        this.title = requestDto.getTitle();
        this.contents = requestDto.getContents();
    }

    public void update(PostRequestDto requestDto) {
        // ì œëª©, ì‘ì„± ë‚´ìš©ì„ ìˆ˜ì •
        this.title = requestDto.getTitle();
        this.contents = requestDto.getContents();
    }
}
```
Post ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.
idëŠ” ìë™ìœ¼ë¡œ ì¦ê°€ë˜ë„ë¡ ì„¤ì •í•˜ê³ , ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥ë°›ìœ¼ë©° user í…Œì´ë¸”ê³¼ ë‹¤ëŒ€ì¼ë¡œ ê´€ê³„ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
ê²Œì‹œê¸€ì— ëŒ€í•œ ìˆ˜ì •ë‚´ìš©ì„ ë°˜ì˜í•˜ê¸° ìœ„í•œ update ë©”ì†Œë“œë„ ì¡´ì¬í•œë‹¤.


3-2. Timestapmed.java
```java
@Getter
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class Timestamped {

    @CreatedDate
    @Column(updatable = false)        // ì´í›„ì—ëŠ” ê°’ì´ ìˆ˜ì •ë˜ì§€ ì•ŠìŒ
    @Temporal(TemporalType.TIMESTAMP)
    private LocalDateTime createTime;

    @LastModifiedDate
    @Column
    @Temporal(TemporalType.TIMESTAMP)
    private LocalDateTime modifyTime;
}
```
ê²Œì‹œê¸€ì˜ ê²Œì‹œì¼ê³¼ ìˆ˜ì •ì¼ì„ ì§€ì •í•˜ê¸° ìœ„í•œ ì¶”ìƒ í´ë˜ìŠ¤ì´ë‹¤.

3-3. User.java
```java
@Entity
@Getter
@Setter
@NoArgsConstructor
@Table(name = "users")
public class User {

    @Id
    @Size(min = 4, max = 10)
    @Pattern(regexp = "^[a-z0-9]*$")
    @Column(name = "username", nullable = false, unique = true)
    private String username;  // ì‚¬ìš©ì ì´ë¦„

    @Size(min = 8, max = 15)
    @Pattern(regexp = "^[a-zA-Z0-9]*$")
    @Column(name = "password", nullable = false)
    private String password;   // ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸

    @OneToMany(mappedBy = "user") 
    private List<Post> postList = new ArrayList<>();

    @Column(nullable = false)
    @Enumerated(value = EnumType.STRING)
    private UserRoleEnum role;

    public User(String username, String password , UserRoleEnum role) {
        this.username = username;
        this.password = password;
        this.role = role;
    }

    public void addPostList(Post post) {
        this.postList.add(post);
        post.setUser(this);
    }
}
```
ì‚¬ìš©ìì— ëŒ€í•œ Entity í´ë˜ìŠ¤ì´ë‹¤.
ì‚¬ìš©ìì˜ ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸, ì—­í• ì„ ì €ì¥í•˜ê³ , post í…Œì´ë¸”ê³¼ ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤.
post ë¦¬ìŠ¤íŠ¸ì— postë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ addPostList ë©”ì†Œë“œë„ ì¡´ì¬í•œë‹¤.

3-4. UserRoleEnum.java
```java
public enum UserRoleEnum {

    USER(Authority.USER), // ì‚¬ìš©ì ê¶Œí•œ
    ADMIN(Authority.ADMIN);  // ê´€ë¦¬ì ê¶Œí•œ

    private final String authority;
    UserRoleEnum(String authority) {
        this.authority = authority;
    }

    public String getAuthority() {
        return this.authority;
    }

    public static class Authority {
        public static final String USER = "ROLE_USER";
        public static final String ADMIN = "ROLE_ADMIN";
    }
}
```
ì‚¬ìš©ìì˜ ì—­í• ì„ ì €ì¥í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.
ì•„ë˜ì˜ UserServiceì— ì½”ë“œê°€ ìˆì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ìì˜ ê¶Œí•œì„ ì „ë¶€ Userë¡œ ì„¤ì •í•˜ì—¬ ì‚¬ìš©í–ˆë‹¤.


4. jwt íŒ¨í‚¤ì§€
   
4-1. JwtUtil.java
```java
@Slf4j(topic = "JwtUtil")
@Component // Beanìœ¼ë¡œ ë“±ë¡í•  ì—ë„ˆí…Œì´ì…˜
public class JwtUtil {

    // Header Key ê°’
    public static final String AUTHORIZATION_HEADER = "Authorization";
    // ì‚¬ìš©ì ê¶Œí•œ ê°’ì˜ Key
    public static final String AUTHORIZAION_KEY = "auth";
    // Token ì‹ë³„ì
    public static final String BEARER_PREFIX = "Bearer ";
    // Token ë§Œë£Œ ì‹œê°„
    public final Long TOKEN_TIME = 60 * 60 * 1000L; // 60ë¶„

    @Value("${jwt.secret.key}")
    private String secretKey;
    private Key key;
    private final SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;

    @PostConstruct
    public void init() {
        byte[] bytes = Base64.getDecoder().decode(secretKey);
        key = Keys.hmacShaKeyFor(bytes);
    }

    // Token ìƒì„±
    public String createToken(String username, UserRoleEnum role) {
        Date date = new Date();

        return BEARER_PREFIX +
                Jwts.builder()
                        .setSubject(username) // ì‚¬ìš©ì ì‹ë³„ìê°’ (ì‚¬ìš©ì ì´ë¦„)
                        .claim(AUTHORIZAION_KEY, role) // ì‚¬ìš©ì ê¶Œí•œ
                        .setExpiration(new Date(date.getTime() + TOKEN_TIME)) // í† í° ë§Œë£Œ ì‹œê°„
                        .setIssuedAt(date) // ë°œê¸‰ì¼
                        .signWith(key, signatureAlgorithm) // ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜
                        .compact();
    } // createToken()
    
    // Headerì—ì„œ JWT ê°€ì ¸ì˜¤ê¸°
    public String getJwtFromHeader(HttpServletRequest request) {
        // Headerì—ì„œ í† í° ë½‘ê¸°
        String bearerToken = request.getHeader(AUTHORIZATION_HEADER);
        // í† í°ì´ nullì´ ì•„ë‹ˆë©´ì„œ ë¹„ì–´ìˆì§€ ì•Šê³ , Bearerë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸ í›„
        if (StringUtils.hasText(bearerToken) && bearerToken.startsWith(BEARER_PREFIX)) {
            return bearerToken.substring(7); // 7ë²ˆì§¸ ë¶€í„° ì˜ë¼ì„œ ê°€ì ¸ì˜¤ê¸°
        }
        return null;
    }

    // Token ê²€ì¦
    public boolean validateToken(String token) {
        try {
            Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token);
            return true;
        } catch (/*SecurityException |*/ MalformedJwtException | SecurityException e) {
            log.error("Invalid JWT signature, ìœ íš¨í•˜ì§€ ì•Šì€ JWT ì„œëª…ì…ë‹ˆë‹¤.");
        } catch (ExpiredJwtException e) {
            log.error("Expired JWT token, ë§Œë£Œëœ JWT í† í°ì…ë‹ˆë‹¤.");
        } catch (UnsupportedJwtException e) {
            log.error("Unsupported JWT token, ì§€ì›ë˜ì§€ ì•Šì€ JWT í† í°ì…ë‹ˆë‹¤.");
        } catch (IllegalArgumentException e) {
            log.error("JWT claims is empty, ì˜ëª»ëœ JWT í† í°ì…ë‹ˆë‹¤.");
        }
        return false;
    }

    // Token ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    public Claims getUserInfoFromToken(String token) {
        return Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token).getBody();
    }
}
```
Jwt í† í°ì— ëŒ€í•œ ê¸°ëŠ¥ì´ ë‹´ê¸´ í´ë˜ìŠ¤ì´ë‹¤.
ì‚¬ìš©ìì˜ ì´ë¦„ê³¼ ì—­í• ë¡œ tokenì„ ìƒì„±í•˜ê³ , headerì—ì„œ í† í°ì„ ê°€ì ¸ì˜¤ê³ , í† í°ì„ ê²€ì¦í•˜ê³ , í† í°ì—ì„œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì†Œë“œê°€ ì¡´ì¬í•œë‹¤.


5. repository íŒ¨í‚¤ì§€
   
5-1. PostRepository.java
```java
public interface PostRepository extends JpaRepository<Post, Long> {
    // ëª¨ë“  ë©”ëª¨ë“¤ì„ ìƒì„±í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
    List<Post> findAllByOrderByCreateTimeDesc();
}
```
ê²Œì‹œê¸€ì— ëŒ€í•œ Repository í´ë˜ìŠ¤ì´ë‹¤.
ë©”ëª¨ë“¤ì„ ìƒì„± ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ê¸° ìœ„í•œ ë©”ì†Œë“œê°€ ìˆë‹¤.

5-2. UserRepository.java
```java
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
}
```
ì‚¬ìš©ìì— ëŒ€í•œ Repository í´ë˜ìŠ¤ì´ë‹¤.
ì‚¬ìš©ìì˜ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì°¾ê¸° ìœ„í•œ ë©”ì†Œë“œê°€ ìˆë‹¤.


6. security íŒ¨í‚¤ì§€
   
6-1. JwtAuthenticationFilter.java
```java
@Slf4j(topic = "ë¡œê·¸ì¸ ë° JWT ìƒì„±")
public class JwtAuthenticationFilter extends UsernamePasswordAuthenticationFilter {

    private final JwtUtil jwtUtil;

    public JwtAuthenticationFilter(JwtUtil jwtUtil) {
        this.jwtUtil = jwtUtil;
        setFilterProcessesUrl("/api/user/login");
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
        try {
            // LoginRequestDto ì‚¬ìš©
            LoginRequestDto requestDto = new ObjectMapper().readValue(request.getInputStream(), LoginRequestDto.class);

            return getAuthenticationManager().authenticate(
                    new UsernamePasswordAuthenticationToken(
                            requestDto.getUsername(),
                            requestDto.getPassword()
                            /*,null*/
                    )
            );
        } catch (IOException e) {
            log.error(e.getMessage());
            throw new RuntimeException(e.getMessage());
        }
    } // attemptAuthentication

    @Override
    public void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException {
        log.info("ë¡œê·¸ì¸ ì„±ê³µ ë° jwt ìƒì„±");
        String username = ((UserDetailsImpl) authResult.getPrincipal()).getUsername();
        UserRoleEnum role = ((UserDetailsImpl) authResult.getPrincipal()).getUser().getRole();

        String token = jwtUtil.createToken(username, role);
        response.addHeader(JwtUtil.AUTHORIZATION_HEADER, token);

        status(200, "ë¡œê·¸ì¸ ì„±ê³µ", response);
    }

    @Override
    public void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) throws IOException {
        response.setStatus(400);
        status(400, "íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤", response);
    }

    // ìƒíƒœ ì½”ë“œ ë°˜í™˜í•˜ê¸°
    public void status(int statusCode, String message, HttpServletResponse response) throws IOException {
        // ì‘ë‹µ ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±
        String jsonResponse = "{\"status\": " + statusCode + ", \"message\": \"" + message + "\"}";
        // Content-Type ë° ë¬¸ì ì¸ì½”ë”© ì„¤ì •
        response.setContentType("application/json");
        response.setCharacterEncoding("UTF-8");
        // PrintWriterë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ë‹µ ë°ì´í„° ì „ì†¡
        PrintWriter writer = response.getWriter();
        writer.write(jsonResponse);
        writer.flush();
    }
}
```
ë¡œê·¸ì¸ ì‹œ JWTë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•´ì£¼ëŠ” Filter í´ë˜ìŠ¤ì´ë‹¤.
LoninRequestDtoë¥¼ í†µí•´ì„œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ê³ , ì¼ì¹˜í•˜ëŠ” ê²½ìš° í† í°ì„ ìƒì„±í•˜ì—¬ response headerì— ë‹´ì•„ì¤€ë‹¤.
ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•œ status() ë©”ì†Œë“œë„ ì¡´ì¬í•œë‹¤.


6-2. JwtAuthorizationFilter.java
```java
@Slf4j(topic = "JWT ê²€ì¦ ë° ì¸ê°€")
public class JwtAuthorizationFilter extends OncePerRequestFilter {

    private final JwtUtil jwtUtil;
    private final UserDetailsServiceImpl userDetailsService;

    public JwtAuthorizationFilter(JwtUtil jwtUtil, UserDetailsServiceImpl userDetailsService) {
        this.jwtUtil = jwtUtil;
        this.userDetailsService = userDetailsService;
    }

    @Override
    protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain filterChain) throws ServletException, IOException {
        String tokenValue = jwtUtil.getJwtFromHeader(req);

        if (StringUtils.hasText(tokenValue)) {

            if (!jwtUtil.validateToken(tokenValue)) {
                log.error("Token Error");
                return;
            }

            Claims info = jwtUtil.getUserInfoFromToken(tokenValue);

            try {
                setAuthentication(info.getSubject());
            } catch (Exception e) {
                log.error(e.getMessage());
                return;
            }
        } // if

        filterChain.doFilter(req, res);
    } // doFilterInternal

    // ì¸ì¦ ì²˜ë¦¬
    public void setAuthentication(String username) {
        SecurityContext context = SecurityContextHolder.createEmptyContext();
        Authentication authentication = createAuthentication(username);
        context.setAuthentication(authentication);
        SecurityContextHolder.setContext(context);
    } // setAuthentication

    // ì¸ì¦ ê°ì²´ ìƒì„±
    public Authentication createAuthentication(String username) {
        UserDetails userDetails = userDetailsService.loadUserByUsername(username);
        // return íƒ€ì…ì´ Authentication ì„
        return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
    } // createAuthentication()
}
```
JWTë¥¼ ê²€ì¦í•˜ê³  ì¸ê°€í•˜ê¸° ìœ„í•œ Filter í´ë˜ìŠ¤ì´ë‹¤.
Headerë¡œë¶€í„° ì–»ì€ í† í°ì´ ë¹„ì–´ìˆëŠ”ì§€, ìœ íš¨í•œì§€ ê²€ì¦í•œ í›„ ì˜¬ë°”ë¥´ë‹¤ë©´ ì¸ì¦ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

6-3. UserDetailsImpl.java
```java
public class UserDetailsImpl implements UserDetails {

    private User user;

    public UserDetailsImpl(User user) {
        this.user = user;
    }

    public User getUser() {
        return user;
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUsername();
    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        UserRoleEnum role = user.getRole();
        String authority = role.getAuthority();

        SimpleGrantedAuthority simpleGrantedAuthority = new SimpleGrantedAuthority(authority);
        Collection<GrantedAuthority> authorities = new ArrayList<>();
        authorities.add(simpleGrantedAuthority);

        return authorities;
    }

    @Override
    public boolean isAccountNonExpired() { return true; }

    @Override
    public boolean isAccountNonLocked() { return true; }

    @Override
    public boolean isCredentialsNonExpired() { return true; }

    @Override
    public boolean isEnabled() { return true; }
}
```
UserDetailsë¥¼ implements ë°›ëŠ” UserDetailsImpl í´ë˜ìŠ¤ì´ë‹¤.
ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ ê°–ê³  ìˆë‹¤.

6-4. UserDetailsServiceImpl.java
```java
@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("Not Found " + username));

        return new UserDetailsImpl(user);
    }
}
```
UserDetailsServiceë¥¼ implements ë°›ê³  ìˆëŠ” UserDetailsServiceImpl í´ë˜ìŠ¤ì´ë‹¤.
loadUserByUsername() ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
usernameìœ¼ë¡œ UserRepositoryì—ì„œ ì‚¬ìš©ìë¥¼ ì°¾ì•„ì„œ UserDetailsImpl ê°ì²´ë¥¼ ìƒì„±í•´ ë°˜í™˜í•œë‹¤.

6-5. WebSecurityConfig.java
```java
@Configuration
@EnableWebSecurity // Spring Security ìì› ì‚¬ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì—ë„ˆí…Œì´ì…˜
@RequiredArgsConstructor
public class WebSecurityConfig {

    private final JwtUtil jwtUtil;
    private final UserDetailsServiceImpl userDetailsService;
    private final AuthenticationConfiguration authenticationConfiguration;

    @Bean
    public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration configuration) throws Exception { return configuration.getAuthenticationManager(); }

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() throws Exception {
        JwtAuthenticationFilter filter = new JwtAuthenticationFilter(jwtUtil);
        filter.setAuthenticationManager(authenticationManager(authenticationConfiguration));
        return filter;
    }

    @Bean
    public JwtAuthorizationFilter jwtAuthorizationFilter() {
        // return ì¸ì¦
        return new JwtAuthorizationFilter(jwtUtil, userDetailsService);
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception{
        // CSRF ì„¤ì •
        http.csrf((csrf) -> csrf.disable());

        // ê¸°ë³¸ ì„¤ì •ì¸ Session ë°©ì‹ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³  JWT ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •
        http.sessionManagement((sessionManagement)
                -> sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS));

        http.authorizeHttpRequests((authorizeHttpRequests) ->
                authorizeHttpRequests
                        .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll() // resources ì ‘ê·¼ í—ˆìš© ì„¤ì •
                        .requestMatchers("/").permitAll() // ë©”ì¸ í˜ì´ì§€ ìš”ì²­
                        .requestMatchers("/api/user/**").permitAll() // 'api/user/'ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ ëª¨ë‘ ì ‘ê·¼ í—ˆê°€
                        .requestMatchers("/api/posts").permitAll() // api/posts ë§Œ í—ˆìš©
                        .requestMatchers(HttpMethod.GET,"/api/post/**").permitAll() // í•´ë‹¹ urlì˜ get ìš”ì²­ë§Œ í—ˆìš©
                        .anyRequest().authenticated() // ê·¸ ì™¸ ëª¨ë“  ìš”ì²­ ì¸ì¦ì²˜ë¦¬
        );

        // form ë¡œê·¸ì¸ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        http.formLogin((formLogin) -> formLogin.disable());

        // í•„í„° ê´€ë¦¬
        http.addFilterBefore(jwtAuthorizationFilter(), JwtAuthenticationFilter.class);
        http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
```
Spring Securityë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.
resourcesì— ëŒ€í•œ ì ‘ê·¼ ì—¬ë¶€ì™€, ì§€ì •í•˜ëŠ” urlì— ëŒ€í•œ ìš”ì²­ ì ‘ê·¼ ë“±ì„ ì œì–´í•˜ê³  í•„í„°ì˜ ìˆœì„œë¥¼ ê´€ë¦¬í•œë‹¤.


7. service íŒ¨í‚¤ì§€
   
7-1. PostService.java
```java
@Service
public class PostService {

    @Autowired
    private final PostRepository postRepository;
    @Autowired
    public PostService(PostRepository postRepository) { this.postRepository = postRepository; }
    
    // ê²Œì‹œê¸€ ìƒì„±
    public PostResponseDto createPost(PostRequestDto requestDto, UserDetailsImpl userDetails) {
        Post post = new Post();
        post.setUser(userDetails.getUser());
        post.setTitle(requestDto.getTitle());
        post.setContents(requestDto.getContents());

        // DBì— ì €ì¥
        Post savePost = postRepository.save(post);
        PostResponseDto postResponseDto = new PostResponseDto(savePost);
        return postResponseDto;
    }
    
    // ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
    public List<PostResponseDto> getPosts() {
        return postRepository.findAllByOrderByCreateTimeDesc().stream().map(PostResponseDto::new).toList();
    }

    // ì„ íƒ ê²Œì‹œê¸€ ì¡°íšŒ
    public PostResponseDto getOnePost(Long id) {
        Post post = findPost(id);
        PostResponseDto postResponseDto = new PostResponseDto(post);
        return postResponseDto;
    }
    
    // ê²Œì‹œê¸€ ìˆ˜ì •
    @Transactional
    public PostResponseDto updatePost(Long id, PostRequestDto requestDto, UserDetailsImpl userDetails) {
        Post post = findPost(id);

        if (post.getUser().getUsername().equals(userDetails.getUsername())) {
            post.update(requestDto);
            PostResponseDto postResponseDto = new PostResponseDto(post);
            return postResponseDto;
        } else {
            return null;
        }
    }

    // ê²Œì‹œê¸€ ì‚­ì œ
    public StatusResponseDto deletePost(Long id, UserDetailsImpl userDetails) {
        Post post = findPost(id);

        if (userDetails.getUsername().equals(post.getUser().getUsername())) {
            postRepository.delete(post);
            StatusResponseDto statusResponseDto = new StatusResponseDto();
            statusResponseDto.setMsg("ê²Œì‹œê¸€ ì‚­ì œ ì„±ê³µ");
            statusResponseDto.setStatusCode(200);
            return statusResponseDto;
        } else {
            return null;
        }

    }

    // í•´ë‹¹ í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì•„ì„œ ë°˜í™˜
    private Post findPost(Long id) {
        return postRepository.findById(id).orElseThrow(() ->
                new IllegalArgumentException("ì„ íƒí•œ ê²Œì‹œê¸€ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
    }
}
```
ê²Œì‹œê¸€ì— ëŒ€í•œ Service í´ë˜ìŠ¤ì´ë‹¤.
ê²Œì‹œê¸€ ì „ì²´ì¡°íšŒì™€ ì„ íƒ ê²Œì‹œê¸€ ì¡°íšŒëŠ” ê°ê° PostResponseDtoì— ë‹´ì•„ ë°˜í™˜í•œë‹¤.
ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ëŠ” ë©”ì†Œë“œëŠ” ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ í•´ë‹¹ ê²Œì‹œê¸€ì— ì‚¬ìš©ìë¥¼ ë„£ì–´ì¤€ë‹¤.
ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ê³ , ì‚­ì œí•˜ëŠ” ë©”ì†Œë“œì—ëŠ” ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ ê²Œì‹œê¸€ì˜ ì‘ì„±ìì¸ì§€ í™•ì¸í•˜ì—¬ ìˆ˜ì •/ì‚­ì œë¥¼ ì§„í–‰í•œë‹¤.
ê²Œì‹œê¸€ idë¥¼ ë°›ì•„ì™€ì„œ postRepositoryì—ì„œ í•´ë‹¹ ê²Œì‹œê¸€ì´ ìˆëŠ”ì§€ ì°¾ëŠ” ë©”ì†Œë“œê°€ ìˆë‹¤.

7-2. UserService.java
```java
@Slf4j
@Service
public class UserService {

    @Autowired
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    private final JwtUtil jwtUtil;

    public UserService(UserRepository userRepository, PasswordEncoder passwordEncoder, JwtUtil jwtUtil) {
        this.userRepository = userRepository;
        this.passwordEncoder = passwordEncoder;
        this.jwtUtil = jwtUtil;
    }

    // íšŒì›ê°€ì…
    public StatusResponseDto signup(SignupRequestDto requestDto) {
        String username = requestDto.getUsername();
        log.info(username);
        String password = passwordEncoder.encode(requestDto.getPassword());

        // íšŒì› ì¤‘ë³µ í™•ì¸
        Optional<User> checkUsername = userRepository.findByUsername(username);
        if (checkUsername.isPresent()) {
            throw new IllegalArgumentException("ì¤‘ë³µëœ ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
        }

        // ì‚¬ìš©ì ROLE - USERë¡œ ë“±ë¡
        UserRoleEnum role = UserRoleEnum.USER;

        // ì‚¬ìš©ì ë“±ë¡
        User user = new User(username, password, role);
        userRepository.save(user);

        StatusResponseDto statusResponseDto = new StatusResponseDto();
        statusResponseDto.setMsg("íšŒì›ê°€ì… ì„±ê³µ");
        statusResponseDto.setStatusCode(200);
        return statusResponseDto;
    }
}
```
ì‚¬ìš©ìì— ëŒ€í•œ Service í´ë˜ìŠ¤ì´ë‹¤.
íšŒì›ê°€ì…ì„ ì§„í–‰í•˜ë©°, userRepositoryì— ì¤‘ë³µë˜ëŠ” usernameì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‚¬ìš©ìë¥¼ ë“±ë¡í•œë‹¤.

![Footer](https://capsule-render.vercel.app/api?type=waving&color=auto&height=200&section=footer)
